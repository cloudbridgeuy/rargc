action=${1:-}

case $action in
{% if commands %}{% for name, command in commands %}
    {{ name }})
        action="{{ name }}"
        shift
        parse_{{ name }}_arguments "$@"
        shift $#
        ;;
{%- endfor %}{% endif %}
    "")
      usage >&2
      exit 1
      ;;
    *)
      {% if default -%}
      ;;
      {% else -%}
      printf "Invalid command: %s\n" "$action" >&2
      exit 1
      ;;
      {%- endif %}
  esac
